from mimblewimble.models.slatepack.message import slatepack_unpack

from mimblewimble.codecs import Base64Codec

from mimblewimble.slatebuilder.slate import Slate

# source test_slatepack_manual_decryption
ba_s1 = 'AAQAA1P+Bc0Hi0uPlgtWr28aM7EBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAADrcDeAAAAAAAL68IAEAAlMz9n6EXttW4wnWnBvFa4lU3gmCuizkIRMLchUZp6eaAjLZtJkEPfs1zpdSOzmmDRsiyi6XMmJwS3Wz1h4F1JbpAt1sOfZO8VQjJJ9vPFlCF3tjYUluC2anE8kkBpdXMnu7rZFue/Q2l5j0fYLiGhRWqNeRTAriNW3sgUqboR9t9rIA'
ba_s1_json = {
    'ver': '4:3',
    'id': '53fe05cd-078b-4b8f-960b-56af6f1a33b1',
    'sta': 'S1',
    'amt': 987500000,
    'fee': 12500000,
    'sigs': [
        {
            'xs': '025333f67e845edb56e309d69c1bc56b8954de0982ba2ce421130b721519a7a79a',
            'nonce': '0232d9b499043dfb35ce97523b39a60d1b22ca2e973262704b75b3d61e05d496e9'
        }
    ],
    'proof': {
        'saddr': 'dd6c39f64ef15423249f6f3c5942177b6361496e0b66a713c924069757327bbb',
        'raddr': 'ad916e7bf4369798f47d82e21a1456a8d7914c0ae2356dec814a9ba11f6df6b2'
    }
}

ba_s2 = 'AAQAA1P+Bc0Hi0uPlgtWr28aM7ECQEiMwcqE4OJ0v4WrC58Sq8wYoIyD6f6jFCWrA2uMo48AAQEDCwq0jluOoUy+IeAG4DY/sUmpIHl9DUgGDfUNhsxDAisD+9oFyODFaa5IRF+Xq/+7L0wrdnlq5Xtk4O8Nb5cHAaL72gXI4MVprkhEX5er/7svTCt2eWrle2Tg7w1vlwcBoig1KMskAAB69AIK+2MBdSWpSIcw6220+mMa+lajJUzyAwABAQAJb/ypAPNhBVfE9Qc+zBiClBWBE6qIFhVWIYP18samsmoAAAAAAAACo2RHJ5usYpRb4hEPP+srfIlzRPMrJVyBsPerZMy9Vxfy1SCnJaojLzXUT/rbWh7/01u8Z+j+lTLfLFCWgePCne4AUmgXcz6qjPBZ9D75gOgnjQ4vptkyh4iBunGycMOT4arXJjf4ZpBPq+O+Ri+8tix1Fc71vXvJMILMpZ+OhUCWQ6IcLKHni0o5ENqHt0iZueY/LYqfD+benJ/T7ZA3gLphasWLU4DRscsKUNi/SaJeb+Bs//VWmRwgwdLg/Q63TnQfMP0Pi++K7cbgd3mK9//2xqL8MvOHJeovC1iYn+4gsb036MebrBhe5gqg3BdxCEw9I0us3iU4ONGHj3f9y0Hxt/ZjtkPC2hfRwl9FptUGe7hMEkkV1faHL5+whZnbq9Tgkt3E6CRiuuXhDPk/wD12M1aBIfIvUKw53ELfmW4Sy04/JV0hfj6JYCPdLvbmYR4bCYJW+OGJOxJU74CBTLyT+gAzzJ9yp/VpllfJuNxXlwiEYFz03BqdtV8ZhhQmD88LAJRfF9pDTek1WNCDctl928aFYCY/xRNWxjtaG4FysyrMVNq380Rsp5WwDUCqRHdJshFPz+HnOZN31yo4aTSwQe49El59d7Tn03dYdtN3pU4BxmuJDuDR7prHryB6MSVVo7ABCnyACilmSvFmOp8y1vgCTbJXVrTj0MVARmv/O/yg5XA5CS59BnxKcAkKaTvCs6LZvXRb03kTNaDamycmvKzI23bCZTTDCwDBU1u9yB4+KLITF+pKx5TWr+6L91SSV585ClVwDVUV5zWkOZm1uSUGPI9fY0UnHN6yzwiKWCAtJdigaiV6FRBJfwz49fCeUCsu2OA1IUNQJ0dA4WKfZvyKhK2sgO3ny+sIHQG6U1LiSAmcpuVo/Ka2mpRAso8sM91sOfZO8VQjJJ9vPFlCF3tjYUluC2anE8kkBpdXMnu7rZFue/Q2l5j0fYLiGhRWqNeRTAriNW3sgUqboR9t9rIBjGWkBYvACKTsep3bSE9bV/9AHteumW4ldwZCx9hpTPCucZGwYDIDlonWPIrIPpWRHCUjRFERkvyF2AhsNJFECQ=='
ba_s2_json = {
    'ver': '4:3',
    'id': '53fe05cd-078b-4b8f-960b-56af6f1a33b1',
    'sta': 'S2',
    'off': '40488cc1ca84e0e274bf85ab0b9f12abcc18a08c83e9fea31425ab036b8ca38f',
    'sigs': [
        {
            'xs': '030b0ab48e5b8ea14cbe21e006e0363fb149a920797d0d48060df50d86cc43022b',
            'nonce': '03fbda05c8e0c569ae48445f97abffbb2f4c2b76796ae57b64e0ef0d6f970701a2',
            'part': 'a20107976f0defe0647be56a79762b4c2fbbffab975f4448ae69c5e0c805dafbf24c25a356fa1a63fab46deb308748a925750163fb0a02f47a000024cb283528'
        }
    ],
    'coms': [
        {
            'c': '096ffca900f3610557c4f5073ecc188294158113aa881615562183f5f2c6a6b26a',
            'p': '6447279bac62945be2110f3feb2b7c897344f32b255c81b0f7ab64ccbd5717f2d520a725aa232f35d44ffadb5a1effd35bbc67e8fe9532df2c509681e3c29dee00526817733eaa8cf059f43ef980e8278d0e2fa6d932878881ba71b270c393e1aad72637f866904fabe3be462fbcb62c7515cef5bd7bc93082cca59f8e85409643a21c2ca1e78b4a3910da87b74899b9e63f2d8a9f0fe6de9c9fd3ed903780ba616ac58b5380d1b1cb0a50d8bf49a25e6fe06cfff556991c20c1d2e0fd0eb74e741f30fd0f8bef8aedc6e077798af7fff6c6a2fc32f38725ea2f0b58989fee20b1bd37e8c79bac185ee60aa0dc1771084c3d234bacde253838d1878f77fdcb41f1b7f663b643c2da17d1c25f45a6d5067bb84c124915d5f6872f9fb08599dbabd4e092ddc4e82462bae5e10cf93fc03d7633568121f22f50ac39dc42df996e12cb4e3f255d217e3e896023dd2ef6e6611e1b098256f8e1893b1254ef80814cbc93fa0033cc9f72a7f5699657c9b8dc57970884605cf4dc1a9db55f198614260fcf0b00945f17da434de93558d08372d97ddbc68560263fc51356c63b5a1b8172b32acc54dab7f3446ca795b00d40aa447749b2114fcfe1e7399377d72a386934b041ee3d125e7d77b4e7d3775876d377a54e01c66b890ee0d1ee9ac7af207a312555a3b0010a7c800a29664af1663a9f32d6f8024db25756b4e3d0c540466bff3bfca0e57039092e7d067c4a70090a693bc2b3a2d9bd745bd3791335a0da9b2726bcacc8db76c26534c30b00c1535bbdc81e3e28b21317ea4ac794d6afee8bf75492579f390a55700d5515e735a43999b5b925063c8f5f6345271cdeb2cf088a58202d25d8a06a257a1510497f0cf8f5f09e502b2ed8e035214350274740e1629f66fc8a84adac80ede7cbeb081d01ba5352e248099ca6e568fca6b69a9440b28f2c33'
        }
    ],
    'proof': {
        'saddr': 'dd6c39f64ef15423249f6f3c5942177b6361496e0b66a713c924069757327bbb',
        'raddr': 'ad916e7bf4369798f47d82e21a1456a8d7914c0ae2356dec814a9ba11f6df6b2',
        'rsig': '8c65a4058bc008a4ec7a9ddb484f5b57ff401ed7ae996e25770642c7d8694cf0ae7191b06032039689d63c8ac83e95911c252344511192fc85d8086c34914409'
    }
}

ba_s3 = 'AAQAA1P+Bc0Hi0uPlgtWr28aM7EDIeyFsJzBL7KTpA+x8TNiWWuyP3prlZUI28ZAqFB2Xd4EAAAAAAC+vCACAQMLCrSOW46hTL4h4AbgNj+xSakgeX0NSAYN9Q2GzEMCKwP72gXI4MVprkhEX5er/7svTCt2eWrle2Tg7w1vlwcBovvaBcjgxWmuSERfl6v/uy9MK3Z5auV7ZODvDW+XBwGiKDUoyyQAAHr0Agr7YwF1JalIhzDrbbT6Yxr6VqMlTPIBAlMz9n6EXttW4wnWnBvFa4lU3gmCuizkIRMLchUZp6eaAjLZtJkEPfs1zpdSOzmmDRsiyi6XMmJwS3Wz1h4F1JbpMtm0mQQ9+zXOl1I7OaYNGyLKLpcyYnBLdbPWHgXUluk7wfBwJgPlSW7xw3ka1oM3q74mc3dyfy1+D9K2Vc1ynQMAAgAACCqQq7/DLLzi5Jbz46qzyBZx77KicvXZGGxUqttsj8OFAQAJb/ypAPNhBVfE9Qc+zBiClBWBE6qIFhVWIYP18samsmoAAAAAAAACo2RHJ5usYpRb4hEPP+srfIlzRPMrJVyBsPerZMy9Vxfy1SCnJaojLzXUT/rbWh7/01u8Z+j+lTLfLFCWgePCne4AUmgXcz6qjPBZ9D75gOgnjQ4vptkyh4iBunGycMOT4arXJjf4ZpBPq+O+Ri+8tix1Fc71vXvJMILMpZ+OhUCWQ6IcLKHni0o5ENqHt0iZueY/LYqfD+benJ/T7ZA3gLphasWLU4DRscsKUNi/SaJeb+Bs//VWmRwgwdLg/Q63TnQfMP0Pi++K7cbgd3mK9//2xqL8MvOHJeovC1iYn+4gsb036MebrBhe5gqg3BdxCEw9I0us3iU4ONGHj3f9y0Hxt/ZjtkPC2hfRwl9FptUGe7hMEkkV1faHL5+whZnbq9Tgkt3E6CRiuuXhDPk/wD12M1aBIfIvUKw53ELfmW4Sy04/JV0hfj6JYCPdLvbmYR4bCYJW+OGJOxJU74CBTLyT+gAzzJ9yp/VpllfJuNxXlwiEYFz03BqdtV8ZhhQmD88LAJRfF9pDTek1WNCDctl928aFYCY/xRNWxjtaG4FysyrMVNq380Rsp5WwDUCqRHdJshFPz+HnOZN31yo4aTSwQe49El59d7Tn03dYdtN3pU4BxmuJDuDR7prHryB6MSVVo7ABCnyACilmSvFmOp8y1vgCTbJXVrTj0MVARmv/O/yg5XA5CS59BnxKcAkKaTvCs6LZvXRb03kTNaDamycmvKzI23bCZTTDCwDBU1u9yB4+KLITF+pKx5TWr+6L91SSV585ClVwDVUV5zWkOZm1uSUGPI9fY0UnHN6yzwiKWCAtJdigaiV6FRBJfwz49fCeUCsu2OA1IUNQJ0dA4WKfZvyKhK2sgO3ny+sIHQG6U1LiSAmcpuVo/Ka2mpRAso8sM91sOfZO8VQjJJ9vPFlCF3tjYUluC2anE8kkBpdXMnu7rZFue/Q2l5j0fYLiGhRWqNeRTAriNW3sgUqboR9t9rIBjGWkBYvACKTsep3bSE9bV/9AHteumW4ldwZCx9hpTPCucZGwYDIDlonWPIrIPpWRHCUjRFERkvyF2AhsNJFECQ=='
ba_s3_json = {
    'ver': '4:3',
    'id': '53fe05cd-078b-4b8f-960b-56af6f1a33b1',
    'sta': 'S3',
    'off': '21ec85b09cc12fb293a40fb1f13362596bb23f7a6b959508dbc640a850765dde',
    'fee': 12500000,
    'sigs': [
        {
            'xs': '030b0ab48e5b8ea14cbe21e006e0363fb149a920797d0d48060df50d86cc43022b',
            'nonce': '03fbda05c8e0c569ae48445f97abffbb2f4c2b76796ae57b64e0ef0d6f970701a2',
            'part': 'a20107976f0defe0647be56a79762b4c2fbbffab975f4448ae69c5e0c805dafbf24c25a356fa1a63fab46deb308748a925750163fb0a02f47a000024cb283528'
        },
        {
            'xs': '025333f67e845edb56e309d69c1bc56b8954de0982ba2ce421130b721519a7a79a',
            'nonce': '0232d9b499043dfb35ce97523b39a60d1b22ca2e973262704b75b3d61e05d496e9',
            'part': 'e996d4051ed6b3754b706232972eca221b0da6393b5297ce35fb3d0499b4d9329d72cd55b6d20f7e2d7f72777326beab3783d61a79c3f16e49e5032670f0c13b'
        }
    ],
    'coms': [
        {
            'c': '082a90abbfc32cbce2e496f3e3aab3c81671efb2a272f5d9186c54aadb6c8fc385'
        },
        {
            'c': '096ffca900f3610557c4f5073ecc188294158113aa881615562183f5f2c6a6b26a',
            'p': '6447279bac62945be2110f3feb2b7c897344f32b255c81b0f7ab64ccbd5717f2d520a725aa232f35d44ffadb5a1effd35bbc67e8fe9532df2c509681e3c29dee00526817733eaa8cf059f43ef980e8278d0e2fa6d932878881ba71b270c393e1aad72637f866904fabe3be462fbcb62c7515cef5bd7bc93082cca59f8e85409643a21c2ca1e78b4a3910da87b74899b9e63f2d8a9f0fe6de9c9fd3ed903780ba616ac58b5380d1b1cb0a50d8bf49a25e6fe06cfff556991c20c1d2e0fd0eb74e741f30fd0f8bef8aedc6e077798af7fff6c6a2fc32f38725ea2f0b58989fee20b1bd37e8c79bac185ee60aa0dc1771084c3d234bacde253838d1878f77fdcb41f1b7f663b643c2da17d1c25f45a6d5067bb84c124915d5f6872f9fb08599dbabd4e092ddc4e82462bae5e10cf93fc03d7633568121f22f50ac39dc42df996e12cb4e3f255d217e3e896023dd2ef6e6611e1b098256f8e1893b1254ef80814cbc93fa0033cc9f72a7f5699657c9b8dc57970884605cf4dc1a9db55f198614260fcf0b00945f17da434de93558d08372d97ddbc68560263fc51356c63b5a1b8172b32acc54dab7f3446ca795b00d40aa447749b2114fcfe1e7399377d72a386934b041ee3d125e7d77b4e7d3775876d377a54e01c66b890ee0d1ee9ac7af207a312555a3b0010a7c800a29664af1663a9f32d6f8024db25756b4e3d0c540466bff3bfca0e57039092e7d067c4a70090a693bc2b3a2d9bd745bd3791335a0da9b2726bcacc8db76c26534c30b00c1535bbdc81e3e28b21317ea4ac794d6afee8bf75492579f390a55700d5515e735a43999b5b925063c8f5f6345271cdeb2cf088a58202d25d8a06a257a1510497f0cf8f5f09e502b2ed8e035214350274740e1629f66fc8a84adac80ede7cbeb081d01ba5352e248099ca6e568fca6b69a9440b28f2c33'
        }
    ],
    'proof': {
        'saddr': 'dd6c39f64ef15423249f6f3c5942177b6361496e0b66a713c924069757327bbb',
        'raddr': 'ad916e7bf4369798f47d82e21a1456a8d7914c0ae2356dec814a9ba11f6df6b2',
        'rsig': '8c65a4058bc008a4ec7a9ddb484f5b57ff401ed7ae996e25770642c7d8694cf0ae7191b06032039689d63c8ac83e95911c252344511192fc85d8086c34914409'
    }
}

def util(slate_base64: str, slate_dict: dict):
    slate_bytes = Base64Codec.decode(slate_base64)
    slate = Slate.deserialize(slate_bytes)
    assert slate.toJSON() == slate_dict
    assert slate.serialize() == slate_bytes

def test_slate_serialization_ba_s1():
    util(ba_s1, ba_s1_json)

def test_slate_serialization_ba_s2():
    util(ba_s2, ba_s2_json)

def test_slate_serialization_ba_s3():
    util(ba_s3, ba_s3_json)
